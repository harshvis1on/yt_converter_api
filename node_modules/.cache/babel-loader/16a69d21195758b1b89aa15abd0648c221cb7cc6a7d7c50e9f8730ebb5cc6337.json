{"ast":null,"code":"import React,{useState,useEffect}from'react';import{useNavigate}from'react-router-dom';import{useAuth}from'../App';import{toast}from'react-toastify';import{syncYouTubeChannel,setupUser}from'../services/n8nApi';import{isOnboardingCompleted}from'../utils/onboarding';// YouTube OAuth scopes for full access\nimport{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const YOUTUBE_SCOPES=['https://www.googleapis.com/auth/youtube.readonly','https://www.googleapis.com/auth/userinfo.profile','https://www.googleapis.com/auth/userinfo.email'].join(' ');const CLIENT_ID='678018511336-jgd34uakj7vika3m6nvf028ekcfu2ucf.apps.googleusercontent.com';function startGoogleOAuth(){const redirectUri=window.location.origin+'/auth/callback';const state=Math.random().toString(36).substring(2,15);localStorage.setItem('oauth_state',state);const url=`https://accounts.google.com/o/oauth2/v2/auth?`+`client_id=${CLIENT_ID}&`+`redirect_uri=${encodeURIComponent(redirectUri)}&`+`response_type=token&`+`scope=${encodeURIComponent(YOUTUBE_SCOPES)}&`+`include_granted_scopes=true&`+`state=${state}&`+`prompt=consent`;window.location.href=url;}function extractTokenFromUrl(){const hash=window.location.hash;console.log('ðŸ” Extracting token from URL hash:',hash);if(!hash||!hash.includes('access_token')){console.log('âŒ No access_token found in URL hash');return null;}try{const params=new URLSearchParams(hash.substring(1));const accessToken=params.get('access_token');const state=params.get('state');const storedState=localStorage.getItem('oauth_state');console.log('ðŸ” Token extraction details:',{accessToken:accessToken?`${accessToken.substring(0,10)}...`:'NULL',state:state,storedState:storedState,stateMatch:state===storedState});// Validate state parameter for security\nif(state&&state===storedState){localStorage.removeItem('oauth_state');console.log('âœ… State validation passed, returning token data');return{accessToken,expiresIn:params.get('expires_in'),scope:params.get('scope')};}else{console.error('âŒ State validation failed - possible CSRF attack');return null;}}catch(error){console.error('âŒ Error extracting token from URL:',error);return null;}}export default function GoogleAuth(){const navigate=useNavigate();const{login}=useAuth();const[loading,setLoading]=useState(false);const[authStep,setAuthStep]=useState('checking');// checking, idle, authenticating, fetching, form, error\nconst[userInfo,setUserInfo]=useState(null);const[error,setError]=useState(null);const[processed,setProcessed]=useState(false);// Prevent reprocessing\n// Check for OAuth callback on mount\nuseEffect(()=>{if(processed){console.log('ðŸ”’ Already processed, skipping...');return;}const checkAuthStatus=async()=>{console.log('ðŸ” GoogleAuth mounted, checking auth status...');console.log('Current URL:',window.location.href);console.log('Hash:',window.location.hash);setProcessed(true);// Mark as processed to prevent loops\n// Check for OAuth callback in URL first (priority)\nconst tokenData=extractTokenFromUrl();if(tokenData){console.log('âœ… OAuth token found in URL, processing fresh callback...');window.history.replaceState(null,null,window.location.pathname);handleAuthSuccess(tokenData);return;}// Then check if user is already authenticated\nconst existingToken=localStorage.getItem('google_token');const existingUserData=localStorage.getItem('user_info');if(existingToken&&existingUserData){console.log('ðŸ” User already authenticated, checking status...');try{const userData=JSON.parse(existingUserData);setUserInfo(userData);// Check if user has existing podcasts\nconsole.log('ðŸ” Checking for existing podcasts...');const{getUserPodcasts}=await import('../services/supabase');const userPodcasts=await getUserPodcasts(userData.sub);if(userPodcasts&&userPodcasts.length>0){console.log('âœ… User has existing podcasts, redirecting to dashboard');localStorage.setItem('currentPodcast',JSON.stringify(userPodcasts[0]));localStorage.setItem('onboardingCompleted','true');toast.success(`Welcome back! Found ${userPodcasts.length} podcast${userPodcasts.length>1?'s':''}.`);setTimeout(()=>{navigate('/dashboard');},1000);return;}else{console.log('ðŸ”„ No existing podcasts, starting onboarding flow...');toast.info('Setting up your podcast creation...');// Start the onboarding flow by calling setupUser and syncYouTubeChannel\ntry{setAuthStep('fetching');const{setupUser,syncYouTubeChannel}=await import('../services/n8nApi');// Setup user with n8n\nconsole.log('Setting up user with n8n...');await setupUser(existingToken,userData);// Sync YouTube channel\nconsole.log('Syncing YouTube channel...');const syncResult=await syncYouTubeChannel(existingToken,userData.id);if(syncResult.success){console.log('âœ… YouTube sync completed, redirecting to podcast creation');toast.success('YouTube channel connected! Creating your podcast...');setTimeout(()=>{navigate('/create-podcast');},1500);}else{throw new Error('YouTube sync failed');}}catch(error){console.error('âŒ Error in onboarding flow:',error);toast.error('Error setting up your account. Please try again.');setAuthStep('idle');}return;}}catch(error){console.warn('âŒ Error checking existing podcasts:',error);setAuthStep('idle');}}else{console.log('â„¹ï¸ No authentication found, showing login screen');setAuthStep('idle');}};checkAuthStatus();},[navigate]);const handleAuthSuccess=async tokenData=>{setLoading(true);setAuthStep('authenticating');try{// Store the access token\nlocalStorage.setItem('google_token',tokenData.accessToken);// Get user info from Google\nconst userResponse=await fetch(`https://www.googleapis.com/oauth2/v2/userinfo?access_token=${tokenData.accessToken}`);let userData=null;if(userResponse.ok){userData=await userResponse.json();setUserInfo(userData);localStorage.setItem('user_info',JSON.stringify(userData));toast.success(`Welcome back, ${userData.name}!`);}else{throw new Error('Failed to get user info from Google');}// Mark user as logged in\nlogin();// Check if user has existing podcasts in Supabase\nconsole.log('ðŸ” Checking for existing podcasts...');try{const{getUserPodcasts}=await import('../services/supabase');const userPodcasts=await getUserPodcasts(userData.sub);if(userPodcasts&&userPodcasts.length>0){// User has existing podcasts, go directly to dashboard\nconsole.log('âœ… User has existing podcasts, redirecting to dashboard');localStorage.setItem('currentPodcast',JSON.stringify(userPodcasts[0]));localStorage.setItem('onboardingCompleted','true');toast.success(`Welcome back! Found ${userPodcasts.length} podcast${userPodcasts.length>1?'s':''}.`);setTimeout(()=>{navigate('/dashboard');},1000);return;}}catch(error){console.warn('âŒ Error checking existing podcasts:',error);// Continue with onboarding if we can't check\n}// Check localStorage onboarding completion as fallback\nif(isOnboardingCompleted()){console.log('âœ… Onboarding marked complete in localStorage, redirecting to dashboard');toast.success('Welcome back! Redirecting to your dashboard...');setTimeout(()=>{navigate('/dashboard',{replace:true});},1500);return;}// User hasn't completed onboarding, continue with the flow\nconsole.log('ðŸ”„ New user detected, starting onboarding flow...');// Setup user in n8n\ntry{await setupUser(tokenData.accessToken,userData);console.log('âœ… User setup completed, waiting before YouTube sync...');// Add delay to prevent n8n execution conflicts\nawait new Promise(resolve=>setTimeout(resolve,2000));// 2 second delay\n}catch(setupError){console.warn('User setup failed, but continuing:',setupError);}// Fetch YouTube channel data for form prefill\nsetAuthStep('fetching');toast.info('Fetching your YouTube channel data...');const result=await syncYouTubeChannel(tokenData.accessToken,userData.id);if(result&&result.success){var _result$channel,_result$videos;// Store channel data and prefill data for form\nlocalStorage.setItem('channelData',JSON.stringify(result.channel));localStorage.setItem('videosData',JSON.stringify(result.videos));localStorage.setItem('prefillData',JSON.stringify(result.prefillData));// Show success and navigate to podcast creation form\nconst channelTitle=((_result$channel=result.channel)===null||_result$channel===void 0?void 0:_result$channel.title)||'Your Channel';const videoCount=((_result$videos=result.videos)===null||_result$videos===void 0?void 0:_result$videos.length)||0;toast.success(`Channel data fetched! Found ${videoCount} videos.`);// Navigate to podcast creation form\nsetTimeout(()=>{navigate('/create-podcast',{replace:true});},1500);}else{throw new Error((result===null||result===void 0?void 0:result.message)||'Failed to fetch YouTube channel data');}}catch(error){console.error('Authentication flow error:',error);setError(error.message);// Show specific error messages\nif(error.message.includes('n8n workflow failed')){toast.error('Connection to our servers failed. Please try again.');}else if(error.message.includes('YouTube')){toast.error('Failed to access your YouTube channel. Please check permissions.');}else{toast.error('Failed to set up your account: '+error.message);}setAuthStep('error');setLoading(false);}};const handleSignIn=()=>{setLoading(true);setAuthStep('authenticating');toast.info('Redirecting to Google...');startGoogleOAuth();};// Show checking state while determining OAuth callback\nif(authStep==='checking'){return/*#__PURE__*/_jsx(\"div\",{className:\"min-h-screen flex items-center justify-center bg-gray-50\",children:/*#__PURE__*/_jsx(\"div\",{className:\"bg-white rounded-xl shadow-lg px-8 py-10 w-full max-w-md\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"text-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-500 mx-auto mb-4\"}),/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg font-semibold text-gray-900 mb-2\",children:\"Loading...\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-600 text-sm\",children:\"Checking authentication status\"})]})})});}// Show error state\nif(authStep==='error'){return/*#__PURE__*/_jsx(\"div\",{className:\"min-h-screen flex items-center justify-center bg-gray-50\",children:/*#__PURE__*/_jsx(\"div\",{className:\"bg-white rounded-xl shadow-lg px-8 py-10 w-full max-w-md\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"text-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-12 h-12 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4\",children:/*#__PURE__*/_jsx(\"svg\",{className:\"w-6 h-6 text-red-600\",fill:\"none\",stroke:\"currentColor\",viewBox:\"0 0 24 24\",children:/*#__PURE__*/_jsx(\"path\",{strokeLinecap:\"round\",strokeLinejoin:\"round\",strokeWidth:2,d:\"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\"})})}),/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg font-semibold text-gray-900 mb-2\",children:\"Authentication Failed\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-600 text-sm mb-4\",children:error||'Something went wrong during authentication'}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>{setError(null);setAuthStep('idle');},className:\"w-full bg-indigo-600 text-white py-2 px-4 rounded-lg hover:bg-indigo-700 transition-colors\",children:\"Try Again\"})]})})});}if(loading){return/*#__PURE__*/_jsx(\"div\",{className:\"min-h-screen flex items-center justify-center bg-gray-50\",children:/*#__PURE__*/_jsx(\"div\",{className:\"bg-white rounded-xl shadow-lg px-8 py-10 w-full max-w-md\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"text-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-500 mx-auto mb-4\"}),authStep==='authenticating'&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg font-semibold text-gray-900 mb-2\",children:\"Authenticating...\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-600 text-sm\",children:\"Verifying your Google account\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"mt-4 space-y-2\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center text-sm text-green-600\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-4 h-4 bg-green-500 rounded-full mr-3\"}),\"Google OAuth verified\"]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center text-sm text-gray-400\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-4 h-4 bg-gray-300 rounded-full mr-3\"}),\"Connect YouTube channel\"]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center text-sm text-gray-400\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-4 h-4 bg-gray-300 rounded-full mr-3\"}),\"Create podcast\"]})]})]}),authStep==='fetching'&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg font-semibold text-gray-900 mb-2\",children:\"Fetching Channel Data\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-600 text-sm\",children:\"Getting your YouTube channel information\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"mt-4 space-y-2\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center text-sm text-green-600\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-4 h-4 bg-green-500 rounded-full mr-3\"}),\"Google OAuth verified\"]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center text-sm text-blue-600\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-4 h-4 bg-blue-500 rounded-full mr-3 animate-pulse\"}),\"Fetching YouTube data...\"]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center text-sm text-gray-400\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-4 h-4 bg-gray-300 rounded-full mr-3\"}),\"Create podcast form\"]})]})]}),userInfo&&/*#__PURE__*/_jsx(\"div\",{className:\"mt-4 p-3 bg-green-50 border border-green-200 rounded-lg\",children:/*#__PURE__*/_jsxs(\"p\",{className:\"text-green-800 text-sm\",children:[\"\\u2705 Signed in as \",userInfo.name]})})]})})});}return/*#__PURE__*/_jsx(\"div\",{className:\"min-h-screen flex items-center justify-center bg-gray-50\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white rounded-xl shadow-lg px-8 py-10 w-full max-w-md\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"text-center mb-8\",children:[/*#__PURE__*/_jsxs(\"span\",{className:\"text-4xl font-bold text-indigo-500 mb-4 block\",children:[\"Pod\",/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-900\",children:\"Pay\"})]}),/*#__PURE__*/_jsx(\"h1\",{className:\"text-2xl font-bold text-gray-900 mb-2\",children:\"Turn Your YouTube into a Podcast\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-600 text-sm\",children:\"Connect with Google to automatically create a podcast from your YouTube channel\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-4 mb-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center text-sm text-gray-700\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-green-500 mr-3\",children:\"\\u2713\"}),/*#__PURE__*/_jsx(\"span\",{children:\"Connects to your YouTube channel\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center text-sm text-gray-700\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-green-500 mr-3\",children:\"\\u2713\"}),/*#__PURE__*/_jsx(\"span\",{children:\"Creates podcast automatically\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center text-sm text-gray-700\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-green-500 mr-3\",children:\"\\u2713\"}),/*#__PURE__*/_jsx(\"span\",{children:\"Publishes to major podcast platforms\"})]})]}),/*#__PURE__*/_jsxs(\"button\",{onClick:handleSignIn,disabled:loading,className:\"w-full flex items-center justify-center bg-white border-2 border-gray-300 py-3 px-4 rounded-lg font-semibold text-gray-700 hover:bg-gray-50 hover:border-gray-400 transition-colors shadow-sm mb-4\",children:[/*#__PURE__*/_jsxs(\"svg\",{className:\"w-5 h-5 mr-3\",viewBox:\"0 0 24 24\",children:[/*#__PURE__*/_jsx(\"path\",{fill:\"#4285F4\",d:\"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z\"}),/*#__PURE__*/_jsx(\"path\",{fill:\"#34A853\",d:\"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z\"}),/*#__PURE__*/_jsx(\"path\",{fill:\"#FBBC05\",d:\"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z\"}),/*#__PURE__*/_jsx(\"path\",{fill:\"#EA4335\",d:\"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z\"})]}),\"Continue with Google\"]}),/*#__PURE__*/_jsx(\"div\",{className:\"text-center\",children:/*#__PURE__*/_jsxs(\"p\",{className:\"text-xs text-gray-500\",children:[\"By continuing, you agree to our Terms of Service and Privacy Policy.\",/*#__PURE__*/_jsx(\"br\",{}),\"We'll access your YouTube channel to create your podcast.\"]})})]})});}","map":{"version":3,"names":["React","useState","useEffect","useNavigate","useAuth","toast","syncYouTubeChannel","setupUser","isOnboardingCompleted","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","YOUTUBE_SCOPES","join","CLIENT_ID","startGoogleOAuth","redirectUri","window","location","origin","state","Math","random","toString","substring","localStorage","setItem","url","encodeURIComponent","href","extractTokenFromUrl","hash","console","log","includes","params","URLSearchParams","accessToken","get","storedState","getItem","stateMatch","removeItem","expiresIn","scope","error","GoogleAuth","navigate","login","loading","setLoading","authStep","setAuthStep","userInfo","setUserInfo","setError","processed","setProcessed","checkAuthStatus","tokenData","history","replaceState","pathname","handleAuthSuccess","existingToken","existingUserData","userData","JSON","parse","getUserPodcasts","userPodcasts","sub","length","stringify","success","setTimeout","info","syncResult","id","Error","warn","userResponse","fetch","ok","json","name","replace","Promise","resolve","setupError","result","_result$channel","_result$videos","channel","videos","prefillData","channelTitle","title","videoCount","message","handleSignIn","className","children","fill","stroke","viewBox","strokeLinecap","strokeLinejoin","strokeWidth","d","onClick","disabled"],"sources":["/Users/harshdeshmukh/YouTube To Mp4 Links/src/components/GoogleAuth.jsx"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport { useAuth } from '../App';\nimport { toast } from 'react-toastify';\nimport { syncYouTubeChannel, setupUser } from '../services/n8nApi';\nimport { isOnboardingCompleted } from '../utils/onboarding';\n\n// YouTube OAuth scopes for full access\nconst YOUTUBE_SCOPES = [\n  'https://www.googleapis.com/auth/youtube.readonly',\n  'https://www.googleapis.com/auth/userinfo.profile', \n  'https://www.googleapis.com/auth/userinfo.email'\n].join(' ');\n\nconst CLIENT_ID = '678018511336-jgd34uakj7vika3m6nvf028ekcfu2ucf.apps.googleusercontent.com';\n\nfunction startGoogleOAuth() {\n  const redirectUri = window.location.origin + '/auth/callback';\n  const state = Math.random().toString(36).substring(2, 15);\n  localStorage.setItem('oauth_state', state);\n  \n  const url = `https://accounts.google.com/o/oauth2/v2/auth?` +\n    `client_id=${CLIENT_ID}&` +\n    `redirect_uri=${encodeURIComponent(redirectUri)}&` +\n    `response_type=token&` +\n    `scope=${encodeURIComponent(YOUTUBE_SCOPES)}&` +\n    `include_granted_scopes=true&` +\n    `state=${state}&` +\n    `prompt=consent`;\n    \n  window.location.href = url;\n}\n\nfunction extractTokenFromUrl() {\n  const hash = window.location.hash;\n  console.log('ðŸ” Extracting token from URL hash:', hash);\n  \n  if (!hash || !hash.includes('access_token')) {\n    console.log('âŒ No access_token found in URL hash');\n    return null;\n  }\n  \n  try {\n    const params = new URLSearchParams(hash.substring(1));\n    const accessToken = params.get('access_token');\n    const state = params.get('state');\n    const storedState = localStorage.getItem('oauth_state');\n    \n    console.log('ðŸ” Token extraction details:', {\n      accessToken: accessToken ? `${accessToken.substring(0, 10)}...` : 'NULL',\n      state: state,\n      storedState: storedState,\n      stateMatch: state === storedState\n    });\n    \n    // Validate state parameter for security\n    if (state && state === storedState) {\n      localStorage.removeItem('oauth_state');\n      console.log('âœ… State validation passed, returning token data');\n      return {\n        accessToken,\n        expiresIn: params.get('expires_in'),\n        scope: params.get('scope')\n      };\n    } else {\n      console.error('âŒ State validation failed - possible CSRF attack');\n      return null;\n    }\n  } catch (error) {\n    console.error('âŒ Error extracting token from URL:', error);\n    return null;\n  }\n}\n\nexport default function GoogleAuth() {\n  const navigate = useNavigate();\n  const { login } = useAuth();\n  \n  const [loading, setLoading] = useState(false);\n  const [authStep, setAuthStep] = useState('checking'); // checking, idle, authenticating, fetching, form, error\n  const [userInfo, setUserInfo] = useState(null);\n  const [error, setError] = useState(null);\n  const [processed, setProcessed] = useState(false); // Prevent reprocessing\n\n  // Check for OAuth callback on mount\n  useEffect(() => {\n    if (processed) {\n      console.log('ðŸ”’ Already processed, skipping...');\n      return;\n    }\n\n    const checkAuthStatus = async () => {\n      console.log('ðŸ” GoogleAuth mounted, checking auth status...');\n      console.log('Current URL:', window.location.href);\n      console.log('Hash:', window.location.hash);\n      \n      setProcessed(true); // Mark as processed to prevent loops\n      \n      // Check for OAuth callback in URL first (priority)\n      const tokenData = extractTokenFromUrl();\n      if (tokenData) {\n        console.log('âœ… OAuth token found in URL, processing fresh callback...');\n        window.history.replaceState(null, null, window.location.pathname);\n        handleAuthSuccess(tokenData);\n        return;\n      }\n      \n      // Then check if user is already authenticated\n      const existingToken = localStorage.getItem('google_token');\n      const existingUserData = localStorage.getItem('user_info');\n      \n      if (existingToken && existingUserData) {\n        console.log('ðŸ” User already authenticated, checking status...');\n        try {\n          const userData = JSON.parse(existingUserData);\n          setUserInfo(userData);\n          \n          // Check if user has existing podcasts\n          console.log('ðŸ” Checking for existing podcasts...');\n          const { getUserPodcasts } = await import('../services/supabase');\n          const userPodcasts = await getUserPodcasts(userData.sub);\n          \n          if (userPodcasts && userPodcasts.length > 0) {\n            console.log('âœ… User has existing podcasts, redirecting to dashboard');\n            localStorage.setItem('currentPodcast', JSON.stringify(userPodcasts[0]));\n            localStorage.setItem('onboardingCompleted', 'true');\n            toast.success(`Welcome back! Found ${userPodcasts.length} podcast${userPodcasts.length > 1 ? 's' : ''}.`);\n            \n            setTimeout(() => {\n              navigate('/dashboard');\n            }, 1000);\n            return;\n          } else {\n            console.log('ðŸ”„ No existing podcasts, starting onboarding flow...');\n            toast.info('Setting up your podcast creation...');\n            \n            // Start the onboarding flow by calling setupUser and syncYouTubeChannel\n            try {\n              setAuthStep('fetching');\n              const { setupUser, syncYouTubeChannel } = await import('../services/n8nApi');\n              \n              // Setup user with n8n\n              console.log('Setting up user with n8n...');\n              await setupUser(existingToken, userData);\n              \n              // Sync YouTube channel\n              console.log('Syncing YouTube channel...');\n              const syncResult = await syncYouTubeChannel(existingToken, userData.id);\n              \n              if (syncResult.success) {\n                console.log('âœ… YouTube sync completed, redirecting to podcast creation');\n                toast.success('YouTube channel connected! Creating your podcast...');\n                \n                setTimeout(() => {\n                  navigate('/create-podcast');\n                }, 1500);\n              } else {\n                throw new Error('YouTube sync failed');\n              }\n            } catch (error) {\n              console.error('âŒ Error in onboarding flow:', error);\n              toast.error('Error setting up your account. Please try again.');\n              setAuthStep('idle');\n            }\n            return;\n          }\n        } catch (error) {\n          console.warn('âŒ Error checking existing podcasts:', error);\n          setAuthStep('idle');\n        }\n      } else {\n        console.log('â„¹ï¸ No authentication found, showing login screen');\n        setAuthStep('idle');\n      }\n    };\n    \n    checkAuthStatus();\n  }, [navigate]);\n\n  const handleAuthSuccess = async (tokenData) => {\n    setLoading(true);\n    setAuthStep('authenticating');\n    \n    try {\n      // Store the access token\n      localStorage.setItem('google_token', tokenData.accessToken);\n      \n      // Get user info from Google\n      const userResponse = await fetch(`https://www.googleapis.com/oauth2/v2/userinfo?access_token=${tokenData.accessToken}`);\n      let userData = null;\n      \n      if (userResponse.ok) {\n        userData = await userResponse.json();\n        setUserInfo(userData);\n        localStorage.setItem('user_info', JSON.stringify(userData));\n        toast.success(`Welcome back, ${userData.name}!`);\n      } else {\n        throw new Error('Failed to get user info from Google');\n      }\n      \n      // Mark user as logged in\n      login();\n      \n      // Check if user has existing podcasts in Supabase\n      console.log('ðŸ” Checking for existing podcasts...');\n      try {\n        const { getUserPodcasts } = await import('../services/supabase');\n        const userPodcasts = await getUserPodcasts(userData.sub);\n        \n        if (userPodcasts && userPodcasts.length > 0) {\n          // User has existing podcasts, go directly to dashboard\n          console.log('âœ… User has existing podcasts, redirecting to dashboard');\n          localStorage.setItem('currentPodcast', JSON.stringify(userPodcasts[0]));\n          localStorage.setItem('onboardingCompleted', 'true');\n          toast.success(`Welcome back! Found ${userPodcasts.length} podcast${userPodcasts.length > 1 ? 's' : ''}.`);\n          \n          setTimeout(() => {\n            navigate('/dashboard');\n          }, 1000);\n          return;\n        }\n      } catch (error) {\n        console.warn('âŒ Error checking existing podcasts:', error);\n        // Continue with onboarding if we can't check\n      }\n\n      // Check localStorage onboarding completion as fallback\n      if (isOnboardingCompleted()) {\n        console.log('âœ… Onboarding marked complete in localStorage, redirecting to dashboard');\n        toast.success('Welcome back! Redirecting to your dashboard...');\n        \n        setTimeout(() => {\n          navigate('/dashboard', { replace: true });\n        }, 1500);\n        return;\n      }\n      \n      // User hasn't completed onboarding, continue with the flow\n      console.log('ðŸ”„ New user detected, starting onboarding flow...');\n      \n      // Setup user in n8n\n      try {\n        await setupUser(tokenData.accessToken, userData);\n        console.log('âœ… User setup completed, waiting before YouTube sync...');\n        // Add delay to prevent n8n execution conflicts\n        await new Promise(resolve => setTimeout(resolve, 2000)); // 2 second delay\n      } catch (setupError) {\n        console.warn('User setup failed, but continuing:', setupError);\n      }\n      \n      // Fetch YouTube channel data for form prefill\n      setAuthStep('fetching');\n      toast.info('Fetching your YouTube channel data...');\n      \n      const result = await syncYouTubeChannel(tokenData.accessToken, userData.id);\n      \n      if (result && result.success) {\n        // Store channel data and prefill data for form\n        localStorage.setItem('channelData', JSON.stringify(result.channel));\n        localStorage.setItem('videosData', JSON.stringify(result.videos));\n        localStorage.setItem('prefillData', JSON.stringify(result.prefillData));\n        \n        // Show success and navigate to podcast creation form\n        const channelTitle = result.channel?.title || 'Your Channel';\n        const videoCount = result.videos?.length || 0;\n        \n        toast.success(`Channel data fetched! Found ${videoCount} videos.`);\n        \n        // Navigate to podcast creation form\n        setTimeout(() => {\n          navigate('/create-podcast', { replace: true });\n        }, 1500);\n        \n      } else {\n        throw new Error(result?.message || 'Failed to fetch YouTube channel data');\n      }\n      \n    } catch (error) {\n      console.error('Authentication flow error:', error);\n      setError(error.message);\n      \n      // Show specific error messages\n      if (error.message.includes('n8n workflow failed')) {\n        toast.error('Connection to our servers failed. Please try again.');\n      } else if (error.message.includes('YouTube')) {\n        toast.error('Failed to access your YouTube channel. Please check permissions.');\n      } else {\n        toast.error('Failed to set up your account: ' + error.message);\n      }\n      \n      setAuthStep('error');\n      setLoading(false);\n    }\n  };\n\n  const handleSignIn = () => {\n    setLoading(true);\n    setAuthStep('authenticating');\n    toast.info('Redirecting to Google...');\n    startGoogleOAuth();\n  };\n\n  // Show checking state while determining OAuth callback\n  if (authStep === 'checking') {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center bg-gray-50\">\n        <div className=\"bg-white rounded-xl shadow-lg px-8 py-10 w-full max-w-md\">\n          <div className=\"text-center\">\n            <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-500 mx-auto mb-4\"></div>\n            <h3 className=\"text-lg font-semibold text-gray-900 mb-2\">Loading...</h3>\n            <p className=\"text-gray-600 text-sm\">Checking authentication status</p>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  // Show error state\n  if (authStep === 'error') {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center bg-gray-50\">\n        <div className=\"bg-white rounded-xl shadow-lg px-8 py-10 w-full max-w-md\">\n          <div className=\"text-center\">\n            <div className=\"w-12 h-12 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4\">\n              <svg className=\"w-6 h-6 text-red-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\n              </svg>\n            </div>\n            <h3 className=\"text-lg font-semibold text-gray-900 mb-2\">Authentication Failed</h3>\n            <p className=\"text-gray-600 text-sm mb-4\">{error || 'Something went wrong during authentication'}</p>\n            <button\n              onClick={() => {\n                setError(null);\n                setAuthStep('idle');\n              }}\n              className=\"w-full bg-indigo-600 text-white py-2 px-4 rounded-lg hover:bg-indigo-700 transition-colors\"\n            >\n              Try Again\n            </button>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  if (loading) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center bg-gray-50\">\n        <div className=\"bg-white rounded-xl shadow-lg px-8 py-10 w-full max-w-md\">\n          <div className=\"text-center\">\n            <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-500 mx-auto mb-4\"></div>\n            \n            {authStep === 'authenticating' && (\n              <>\n                <h3 className=\"text-lg font-semibold text-gray-900 mb-2\">Authenticating...</h3>\n                <p className=\"text-gray-600 text-sm\">Verifying your Google account</p>\n                <div className=\"mt-4 space-y-2\">\n                  <div className=\"flex items-center text-sm text-green-600\">\n                    <div className=\"w-4 h-4 bg-green-500 rounded-full mr-3\"></div>\n                    Google OAuth verified\n                  </div>\n                  <div className=\"flex items-center text-sm text-gray-400\">\n                    <div className=\"w-4 h-4 bg-gray-300 rounded-full mr-3\"></div>\n                    Connect YouTube channel\n                  </div>\n                  <div className=\"flex items-center text-sm text-gray-400\">\n                    <div className=\"w-4 h-4 bg-gray-300 rounded-full mr-3\"></div>\n                    Create podcast\n                  </div>\n                </div>\n              </>\n            )}\n            \n            {authStep === 'fetching' && (\n              <>\n                <h3 className=\"text-lg font-semibold text-gray-900 mb-2\">Fetching Channel Data</h3>\n                <p className=\"text-gray-600 text-sm\">Getting your YouTube channel information</p>\n                <div className=\"mt-4 space-y-2\">\n                  <div className=\"flex items-center text-sm text-green-600\">\n                    <div className=\"w-4 h-4 bg-green-500 rounded-full mr-3\"></div>\n                    Google OAuth verified\n                  </div>\n                  <div className=\"flex items-center text-sm text-blue-600\">\n                    <div className=\"w-4 h-4 bg-blue-500 rounded-full mr-3 animate-pulse\"></div>\n                    Fetching YouTube data...\n                  </div>\n                  <div className=\"flex items-center text-sm text-gray-400\">\n                    <div className=\"w-4 h-4 bg-gray-300 rounded-full mr-3\"></div>\n                    Create podcast form\n                  </div>\n                </div>\n              </>\n            )}\n            \n            {userInfo && (\n              <div className=\"mt-4 p-3 bg-green-50 border border-green-200 rounded-lg\">\n                <p className=\"text-green-800 text-sm\">âœ… Signed in as {userInfo.name}</p>\n              </div>\n            )}\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen flex items-center justify-center bg-gray-50\">\n      <div className=\"bg-white rounded-xl shadow-lg px-8 py-10 w-full max-w-md\">\n        <div className=\"text-center mb-8\">\n          <span className=\"text-4xl font-bold text-indigo-500 mb-4 block\">\n            Pod<span className=\"text-gray-900\">Pay</span>\n          </span>\n          <h1 className=\"text-2xl font-bold text-gray-900 mb-2\">\n            Turn Your YouTube into a Podcast\n          </h1>\n          <p className=\"text-gray-600 text-sm\">\n            Connect with Google to automatically create a podcast from your YouTube channel\n          </p>\n        </div>\n\n        <div className=\"space-y-4 mb-6\">\n          <div className=\"flex items-center text-sm text-gray-700\">\n            <span className=\"text-green-500 mr-3\">âœ“</span>\n            <span>Connects to your YouTube channel</span>\n          </div>\n          <div className=\"flex items-center text-sm text-gray-700\">\n            <span className=\"text-green-500 mr-3\">âœ“</span>\n            <span>Creates podcast automatically</span>\n          </div>\n          <div className=\"flex items-center text-sm text-gray-700\">\n            <span className=\"text-green-500 mr-3\">âœ“</span>\n            <span>Publishes to major podcast platforms</span>\n          </div>\n        </div>\n\n        <button\n          onClick={handleSignIn}\n          disabled={loading}\n          className=\"w-full flex items-center justify-center bg-white border-2 border-gray-300 py-3 px-4 rounded-lg font-semibold text-gray-700 hover:bg-gray-50 hover:border-gray-400 transition-colors shadow-sm mb-4\"\n        >\n          <svg className=\"w-5 h-5 mr-3\" viewBox=\"0 0 24 24\">\n            <path fill=\"#4285F4\" d=\"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z\"/>\n            <path fill=\"#34A853\" d=\"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z\"/>\n            <path fill=\"#FBBC05\" d=\"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z\"/>\n            <path fill=\"#EA4335\" d=\"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z\"/>\n          </svg>\n          Continue with Google\n        </button>\n\n        <div className=\"text-center\">\n          <p className=\"text-xs text-gray-500\">\n            By continuing, you agree to our Terms of Service and Privacy Policy.\n            <br />\n            We'll access your YouTube channel to create your podcast.\n          </p>\n        </div>\n      </div>\n    </div>\n  );\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}