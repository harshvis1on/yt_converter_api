{"ast":null,"code":"import{useState,useEffect}from'react';import{episodeService}from'../services/episodeService';export function useEpisodes(megaphoneId){const[state,setState]=useState({loading:false,error:null,episodes:[],totalCount:0,n8nEpisodes:[]// Track n8n episodes separately\n});useEffect(()=>{if(megaphoneId){loadEpisodes();}},[megaphoneId]);const loadEpisodes=async()=>{try{setState(s=>({...s,loading:true,error:null}));console.log('ðŸ“» Loading episodes from Supabase for Megaphone ID:',megaphoneId);// First get the podcast ID from the megaphone ID\nconst podcastId=await episodeService.getPodcastIdFromMegaphoneId(megaphoneId);if(!podcastId){throw new Error('Podcast not found in database');}// Then get episodes from Supabase\nconst result=await episodeService.getEpisodesFromSupabase(podcastId);if(result.success){const transformedEpisodes=episodeService.transformEpisodeData(result.episodes);setState(s=>({...s,episodes:transformedEpisodes,totalCount:result.totalCount,loading:false}));console.log(`âœ… Loaded ${transformedEpisodes.length} episodes from Supabase`);}else{throw new Error(result.error||'Failed to load episodes');}}catch(error){console.error('âŒ Failed to load episodes:',error);setState(s=>({...s,error:error.message,loading:false,episodes:[],totalCount:0}));}};const refreshEpisodes=()=>{if(megaphoneId){loadEpisodes();}};// Add newly created episodes from n8n workflow results\nconst addN8nEpisodes=function(n8nResults){let originalVideoData=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;console.log('ðŸ“º Adding n8n episodes to display:',n8nResults);if(!n8nResults||!Array.isArray(n8nResults)){console.warn('Invalid n8n results provided:',n8nResults);return;}// Transform n8n data for display, optionally with original video data for better titles\nconst transformedN8nEpisodes=episodeService.transformN8nEpisodeData(n8nResults,originalVideoData);setState(s=>{// Remove any existing n8n episodes with same IDs to avoid duplicates\nconst existingEpisodes=s.episodes.filter(ep=>ep.source!=='n8n');const combinedEpisodes=[...transformedN8nEpisodes,...existingEpisodes];console.log(`âœ… Added ${transformedN8nEpisodes.length} n8n episodes to display`);return{...s,episodes:combinedEpisodes,n8nEpisodes:transformedN8nEpisodes,totalCount:combinedEpisodes.length};});// Refresh from Supabase after a delay to get the persisted data\nsetTimeout(()=>{console.log('ðŸ”„ Refreshing episodes from Supabase after n8n creation...');refreshEpisodes();},3000);};// Clear n8n episodes (when they've been persisted to Supabase)\nconst clearN8nEpisodes=()=>{setState(s=>({...s,n8nEpisodes:[],episodes:s.episodes.filter(ep=>ep.source!=='n8n')}));};return{...state,refreshEpisodes,addN8nEpisodes,clearN8nEpisodes};}","map":{"version":3,"names":["useState","useEffect","episodeService","useEpisodes","megaphoneId","state","setState","loading","error","episodes","totalCount","n8nEpisodes","loadEpisodes","s","console","log","podcastId","getPodcastIdFromMegaphoneId","Error","result","getEpisodesFromSupabase","success","transformedEpisodes","transformEpisodeData","length","message","refreshEpisodes","addN8nEpisodes","n8nResults","originalVideoData","arguments","undefined","Array","isArray","warn","transformedN8nEpisodes","transformN8nEpisodeData","existingEpisodes","filter","ep","source","combinedEpisodes","setTimeout","clearN8nEpisodes"],"sources":["/Users/harshdeshmukh/YouTube To Mp4 Links/src/hooks/useEpisodes.js"],"sourcesContent":["import { useState, useEffect } from 'react';\nimport { episodeService } from '../services/episodeService';\n\nexport function useEpisodes(megaphoneId) {\n  const [state, setState] = useState({\n    loading: false,\n    error: null,\n    episodes: [],\n    totalCount: 0,\n    n8nEpisodes: [] // Track n8n episodes separately\n  });\n\n  useEffect(() => {\n    if (megaphoneId) {\n      loadEpisodes();\n    }\n  }, [megaphoneId]);\n\n  const loadEpisodes = async () => {\n    try {\n      setState(s => ({ ...s, loading: true, error: null }));\n      \n      console.log('ðŸ“» Loading episodes from Supabase for Megaphone ID:', megaphoneId);\n      \n      // First get the podcast ID from the megaphone ID\n      const podcastId = await episodeService.getPodcastIdFromMegaphoneId(megaphoneId);\n      if (!podcastId) {\n        throw new Error('Podcast not found in database');\n      }\n\n      // Then get episodes from Supabase\n      const result = await episodeService.getEpisodesFromSupabase(podcastId);\n      \n      if (result.success) {\n        const transformedEpisodes = episodeService.transformEpisodeData(result.episodes);\n        setState(s => ({ \n          ...s, \n          episodes: transformedEpisodes, \n          totalCount: result.totalCount,\n          loading: false \n        }));\n        console.log(`âœ… Loaded ${transformedEpisodes.length} episodes from Supabase`);\n      } else {\n        throw new Error(result.error || 'Failed to load episodes');\n      }\n    } catch (error) {\n      console.error('âŒ Failed to load episodes:', error);\n      setState(s => ({ \n        ...s, \n        error: error.message, \n        loading: false,\n        episodes: [],\n        totalCount: 0\n      }));\n    }\n  };\n\n  const refreshEpisodes = () => {\n    if (megaphoneId) {\n      loadEpisodes();\n    }\n  };\n\n  // Add newly created episodes from n8n workflow results\n  const addN8nEpisodes = (n8nResults, originalVideoData = null) => {\n    console.log('ðŸ“º Adding n8n episodes to display:', n8nResults);\n    \n    if (!n8nResults || !Array.isArray(n8nResults)) {\n      console.warn('Invalid n8n results provided:', n8nResults);\n      return;\n    }\n\n    // Transform n8n data for display, optionally with original video data for better titles\n    const transformedN8nEpisodes = episodeService.transformN8nEpisodeData(n8nResults, originalVideoData);\n    \n    setState(s => {\n      // Remove any existing n8n episodes with same IDs to avoid duplicates\n      const existingEpisodes = s.episodes.filter(ep => ep.source !== 'n8n');\n      const combinedEpisodes = [...transformedN8nEpisodes, ...existingEpisodes];\n      \n      console.log(`âœ… Added ${transformedN8nEpisodes.length} n8n episodes to display`);\n      \n      return {\n        ...s,\n        episodes: combinedEpisodes,\n        n8nEpisodes: transformedN8nEpisodes,\n        totalCount: combinedEpisodes.length\n      };\n    });\n\n    // Refresh from Supabase after a delay to get the persisted data\n    setTimeout(() => {\n      console.log('ðŸ”„ Refreshing episodes from Supabase after n8n creation...');\n      refreshEpisodes();\n    }, 3000);\n  };\n\n  // Clear n8n episodes (when they've been persisted to Supabase)\n  const clearN8nEpisodes = () => {\n    setState(s => ({\n      ...s,\n      n8nEpisodes: [],\n      episodes: s.episodes.filter(ep => ep.source !== 'n8n')\n    }));\n  };\n\n  return {\n    ...state,\n    refreshEpisodes,\n    addN8nEpisodes,\n    clearN8nEpisodes\n  };\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}